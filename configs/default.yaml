# Global defaults for THREADS reproduction.
# This file must only contain runtime-wide defaults and path/logging policy.
# Stage-specific hyperparameters belong to configs/pretrain.yaml and configs/eval.yaml.

defaults:
  - _self_

project:
  name: "threads_reproduction"
  paper_id: "Molecular-driven Foundation Model for Oncologic Pathology"

runtime:
  # Not specified in the provided root config; explicit sentinel default.
  seed: null
  # Runtime execution mode consumed by AppMain dispatch.
  mode: "preprocess"
  # Device and precision routing are resolved by runtime environment.
  device: "auto"
  precision: "auto"
  # Not specified in the provided root config; explicit sentinel default.
  num_workers: null
  deterministic: true
  cudnn_benchmark: false

environment:
  python_version: "3.10.12"
  pytorch_version: "2.3.0"
  cuda_version: "12.3"

paths:
  output_root: "outputs"
  run_root: "outputs/runs"
  log_root: "outputs/logs"
  checkpoint_root: "outputs/checkpoints"
  cache_root: "outputs/cache"
  split_manifest_root: "outputs/splits"
  resolved_config_name: "resolved_config.yaml"

logging:
  level: "INFO"
  to_console: true
  to_file: true
  use_wandb: true
  log_every_n_steps: 10
  flush_every_n_steps: 50
  wandb:
    project: "threads_reproduction"
    entity: null
    run_name: null
    tags: []

precision_policy:
  pretraining: "AMP (mixed precision)"
  finetuning: "bf16"
  embedding_extraction: "bf16"
  evaluation: "auto"

hardware_policy:
  pretraining:
    gpus: 4
    gpu_type: "NVIDIA A100 80GB"
    distributed: "DDP"
  finetuning:
    gpus: 1
    gpu_type: "NVIDIA 3090Ti 24GB"
  embedding_extraction:
    gpus: 1
    gpu_type: "NVIDIA 3090Ti 24GB"

global_contract:
  invariants:
    - "No module should hardcode runtime seed, paths, device, precision, or worker count."
    - "All modules must consume a validated ExperimentConfig instance from src/config.py."
    - "Resolved merged config must be persisted per run for reproducibility."
    - "Mode must be one of: preprocess, pretrain, evaluate."

hydra:
  run:
    dir: ${paths.run_root}/${now:%Y-%m-%d}/${now:%H-%M-%S}
  job:
    chdir: false
